# Tech Chronicles Writer (Autonomous Mode)

tech-chronicles連載の記事を自律的に執筆する。全工程を中断なく一気通貫で実行する。

## 前提条件

- 作業ディレクトリ: tech-chronicles プロジェクトルート
- ブループリント: `blueprints/{series}.md` が存在すること
- ツールチェーン: `npm run check` が実行可能であること
- このプロンプト末尾に `シリーズ:` と `エピソード:` が指定されている

## 実行フロー

### Phase 0: 引数の解析と検証

このプロンプト末尾の `シリーズ:` と `エピソード:` の値を読み取る。

1. **シリーズ名**: `シリーズ:` の値を使用する
   - `blueprints/{series}.md` の存在を確認する。存在しなければエラー終了

2. **エピソード番号**:
   - `エピソード:` が数値の場合はそれを使用する
   - `auto` の場合:
     1. `series/{series}/ja/README.md` が存在するか確認
     2. 存在する場合 → テーブル内で「執筆予定」ステータスの最初の行からエピソード番号を取得
     3. 存在しない場合 → 第1回（新シリーズの開始）と判定
     4. 全行が「公開済」の場合 → 「全回公開済み」と出力して終了

3. **新シリーズ判定**:
   - `series/{series}/ja/` ディレクトリが存在しない場合、新シリーズフラグを立てる
   - 各Phase でディレクトリが不在なら `mkdir -p` で作成する

### パス解決

全てのファイルパスはシリーズ名から動的に決定する:

| 用途                 | パス                                     |
| -------------------- | ---------------------------------------- |
| ブループリント       | `blueprints/{series}.md`                 |
| 記事本文             | `series/{series}/ja/{NN}-{slug}.md`      |
| ファクトチェック     | `research/{series}/factcheck-{NN}.md`    |
| ハンズオンREADME     | `handson/{series}/{NN}-{slug}/README.md` |
| ハンズオンスクリプト | `handson/{series}/{NN}-{slug}/setup.sh`  |
| シリーズREADME       | `series/{series}/ja/README.md`           |
| ルートREADME         | `README.md`（リポジトリルート）          |

`{NN}` は2桁ゼロ埋め連番（01, 02, ...）。`{slug}` はブループリント内の該当回定義から取得する。

### Phase 1: 準備

1. `blueprints/{series}.md` を読み、該当エピソードの仕様（問い、著者体験、歴史的背景、技術論、ハンズオン、まとめ、slug）を抽出する
2. 直前のエピソードの本文が存在すれば読み、重複回避ポイントを特定する
   - 第1回の場合、またはシリーズ初回の場合はスキップ
3. 該当エピソードのファクトチェック項目を洗い出す（目安: 8-12項目）

### Phase 2: ファクトチェック（WebSearch必須）

**これが最重要工程である。モデルの知識のみでの事実記述は禁止。**

各ファクトチェック項目について:

1. **WebSearch** を実行し、一次ソース（公式サイト、論文、公式ブログ、アーカイブ）を特定する
2. 年号、人名、バージョン番号、統計データを検証する
3. **WebSearchで結果が得られない場合、クエリを変えて最大2回再試行する**（例: 英語クエリ→日本語クエリ、キーワード変更）
4. 検証結果を以下のフォーマットで記録する:

```markdown
## N. 調査項目名

- **結論**: 検証済みの事実
- **一次ソース**: 著者名, タイトル, 出版年
- **URL**: <https://...>
- **注意事項**: 補足・注意点
- **記事での表現**: 記事中での記述案
```

1. 検証できなかった事実は「未検証」と明記する
2. `research/{series}/factcheck-{NN}.md` に保存する
   - `research/{series}/` ディレクトリが存在しない場合は作成する

**品質ゲート: 最低6項目以上が「検証済み」であること。6項目未満の場合はその旨を出力して終了する。**

### Phase 3: 本文執筆

`blueprints/{series}.md` の文体・構成ルールに従い、5部構成で執筆する。

```
1. 導入 -- 問いの提示（1,000-2,000字）
   - 著者の個人的体験から入る
   - その回の「問い」を提示する
   - 読者への問いかけで締める

2. 歴史的背景（3,000-6,000字）
   - ファクトチェック済みの事実のみを使用する
   - 年号・人名・バージョン番号を正確に記述する
   - 当時の技術的制約に必ず言及する

3. 技術論（3,000-6,000字）
   - 図解（テキストベース、Mermaid、ASCIIアート）を使う
   - 他の技術との比較を含める
   - 設計思想・トレードオフを明確にする

4. ハンズオン（2,000-4,000字）
   - 実行可能なコマンドを記述する
   - Docker環境（ubuntu:24.04）推奨
   - 「何が起きるか」「なぜそうなるか」を解説する

5. まとめと次回予告（500-1,500字）
   - 要点を3-5個に整理する
   - 冒頭の問いへの暫定回答を示す
   - 次回への橋渡しと読者への問いかけで締める
```

文体の要点:

- 一人称「私」、である調
- 著者体験は「私は」で開始、歴史的事実は客観記述
- 禁止: 「〜ですね」、「〜と言われています」、「いかがでしたか？」、箇条書きだけの章
- 各回末尾に参考文献リストを付記する

出力先: `series/{series}/ja/{NN}-{slug}.md`

- `series/{series}/ja/` ディレクトリが存在しない場合は作成する

**文字数検証: 執筆後 `wc -m` で文字数を確認する。**

- **10,000字未満の場合**: 最も薄いセクションを特定し、加筆する
- **20,000字超過の場合**: 最も冗長なセクションを特定し、簡潔にする
- 調整後、再度 `wc -m` で確認する

### Phase 4: ハンズオン資材作成

- `handson/{series}/{NN}-{slug}/README.md` -- 概要、演習一覧、動作環境
- `handson/{series}/{NN}-{slug}/setup.sh` -- 自動セットアップスクリプト

setup.sh の構造:

```bash
#!/bin/bash
set -euo pipefail
WORKDIR="${HOME}/{series}-handson-{NN}"
# 演習ごとにセクション分けのechoを入れる
```

- `handson/{series}/` ディレクトリが存在しない場合は作成する

### Phase 5: README更新

`series/{series}/ja/README.md` の処理:

#### 既存シリーズの場合（README.mdが存在する）:

- 目次テーブルで該当回のステータスを「公開済」に変更
- ファイルへのリンクを追加

#### 新シリーズの場合（README.mdが存在しない）:

- `series/{series}/ja/` ディレクトリを作成する
- `series/{series}/ja/README.md` を新規作成する
- 構成:
  - 連載タイトル: ブループリントからパース
  - 著者名: 佐藤裕介（Engineers Hub株式会社 CEO / Technical Lead）
  - 連載概要: ブループリントの核心メッセージから作成
  - 目次テーブル: ブループリント第3部の全回構成から生成
  - 第1回を「公開済」+リンク付き、残りを「執筆予定」
  - 末尾にライセンス（CC BY-SA 4.0）を記載
- 構造の参考: `series/version-control/ja/README.md`

### Phase 5b: ルートREADME更新

リポジトリルートの `README.md` にある「連載シリーズ」テーブルを更新する。

#### 新シリーズの第1回を公開した場合:

- 該当シリーズの行で、状態を「設計完了」→「連載中」に変更する
- シリーズ名をリンク付きに変更する: `[シリーズ名](./series/{series}/ja/)`
- ディレクトリ構成セクションに該当シリーズのエントリがなければ追加する

#### 連載完結（全回公開済み）の場合:

- 該当シリーズの行で、状態を「連載中」→「完結」に変更する

#### それ以外（連載中の新エピソード）:

- ルートREADMEの変更は不要（シリーズREADMEのみ更新）

### Phase 6: 品質チェック

まずフォーマットを適用してから、チェックを実行する。dprintのテーブル整形等で差分が出るため、check前にformatを必ず実行すること。

```bash
npm run format && npm run check
```

エラーがあれば修正し、再度 `npm run format && npm run check` を実行する。

**リトライ上限: 最大3回まで。3回で解消しない場合はエラー内容を出力して終了する。**

### Phase 7: 結果報告

以下をコンソールに出力する:

- シリーズ名とエピソード番号
- 作成/変更したファイル一覧
- 記事の文字数
- 各セクションの概要（1行ずつ）
- ファクトチェック項目数（検証済み / 未検証）
- リントチェックの結果
- 新シリーズの場合はその旨を明記

## 参照ファイル

- ブループリント: `blueprints/{series}.md`（文体・構成・全回設計）
- ブループリント一覧: `blueprints/README.md`
- Claude向けガイド: `guides/ai-guide-claude.md`
- ワークフロー: `guides/workflow-overview.md`
- 既存記事: `series/{series}/ja/` 配下
- 既存ファクトチェック: `research/{series}/` 配下
