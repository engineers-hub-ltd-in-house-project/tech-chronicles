# 第9回ハンズオン：ストアドプロシージャとアプリケーションコードの比較

## 概要

同じビジネスロジック（受注処理）をPostgreSQLのストアドプロシージャとトランザクション付きSQLスクリプトの両方で実装し、保守性・パフォーマンス・テスト容易性の違いを体験する。トリガーによる監査ログの自動記録と、連鎖トリガーの暗黙的な副作用も観察する。

## 演習一覧

1. **ストアドプロシージャによる受注処理** — 在庫確認・在庫更新・受注作成を1回の関数呼び出しで実行する
2. **アプリケーション側SQLによる同じ処理** — 同じロジックをトランザクション付きの個別SQLで実装し、可読性を比較する
3. **パフォーマンス比較** — 1000件の受注処理をストアドプロシージャ版と個別SQL版で実行し、速度差を計測する
4. **トリガーによる監査ログ** — 注文テーブルへの変更を自動的に監査ログに記録するトリガーの動作を確認する
5. **トリガーの連鎖と暗黙的な副作用** — 1回の操作で複数テーブルのトリガーが連鎖的に発火する様子を観察する

## 動作環境

- Docker（PostgreSQL 17 公式イメージを使用）
- ターミナル

## セットアップ

```bash
bash setup.sh
```

## 手動で接続する場合

```bash
docker exec -it db-history-ep09-pg psql -U postgres -d handson
```

## 後片付け

```bash
docker rm -f db-history-ep09-pg
```
