# 第18回ハンズオン：CockroachDB 3ノードクラスタでNewSQLを体験する

## 概要

CockroachDBの3ノードクラスタをDockerで構築し、NewSQLデータベースの特性を体験する。PostgreSQL互換のSQLが分散クラスタ上で動作すること、ノード障害時の自動復旧、分散トランザクションの整合性を確認する。

## 演習一覧

| 演習  | 内容                             | 学べること                                     |
| ----- | -------------------------------- | ---------------------------------------------- |
| 演習1 | クラスタ起動とPostgreSQL互換SQL  | 分散クラスタ上でPostgreSQL構文がそのまま使える |
| 演習2 | 分散トランザクション（送金処理） | 複数Rangeにまたがるトランザクションの原子性    |
| 演習3 | ノード障害と自動復旧             | Raft合意による耐障害性の実体験                 |
| 演習4 | Rangeの分散状況確認              | データがどのノードに配置されているかの可視化   |

## 動作環境

- Docker（Docker Engine 20.10以降）
- メモリ: 4GB以上推奨（各ノード約1GB使用）
- ディスク: 2GB以上の空き容量
- ネットワーク: ローカル環境で完結

## セットアップ

```bash
bash setup.sh
```

## 後片付け

```bash
docker rm -f roach1 roach2 roach3 2>/dev/null || true
docker network rm roachnet 2>/dev/null || true
```

## 注意事項

- `--insecure`フラグで起動しているため、TLS暗号化は無効。本番環境では必ず証明書を設定すること
- CockroachDBのライセンスは2024年以降変更されている。利用条件を確認すること
- ハンズオン用途のため最小構成（3ノード）で起動している。本番環境では5ノード以上を推奨
