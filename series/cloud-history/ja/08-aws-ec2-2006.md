# クラウドの考古学

## ——メインフレームからサーバーレスへ、計算資源の民主化史

### 第8回：AWS EC2（2006年）——「サーバを借りる」概念が変わった日

**連載「クラウドの考古学——メインフレームからサーバーレスへ、計算資源の民主化史」**
**著：佐藤裕介（Engineers Hub株式会社 CEO / Technical Lead）**

---

**この回で学べること：**

- AWS EC2が登場した背景——Amazonの内部インフラ課題と「余剰キャパシティ神話」の真実
- 2003年のChris PinkhamとBenjamin Blackのペーパーが描いたビジョンと、EC2の誕生経緯
- EC2の設計判断——API駆動、従量課金（pay-as-you-go）、インスタンスの使い捨て性（disposability）
- AMI、セキュリティグループ、Availability Zoneという概念が持つ設計思想
- 初期EC2の制約——永続ストレージの不在とEBSの登場がもたらした転換
- AWS CLIによるEC2インスタンスのライフサイクル管理とUserDataによる初期設定自動化

---

## 1. 「サーバは消耗品になったのだ」

2008年のある午後、私はターミナルに向かい、生まれて初めてEC2のAPIを叩いた。

当時の私はコロケーションとホスティングの世界で10年近くを過ごしてきた人間だ。第4回で書いたとおり、秋葉原でラックマウントサーバを買い、自分の車でデータセンターに運び込んでいた。第5回で書いたとおり、ホスティングサービスに移行してからは物理的な搬入からは解放されたが、サーバの調達には依然として数日かかり、スペック変更にはさらに時間がかかった。第6回、第7回では仮想化の恩恵を受け、VMwareやXen/KVMで物理サーバの台数を減らすことはできた。だが、「サーバを用意する」という行為の本質は変わっていなかった。

物理であれ仮想であれ、サーバとは「大事に管理し、長く使い、障害が起きれば修復する」ものだった。サーバには名前を付けた。監視を設定した。ログローテーションを仕込んだ。パッチを当てた。何年も稼働し続けるサーバの前で、私たちは番人のように振る舞っていた。

EC2のAPIを叩いた瞬間、その常識が崩壊した。

コマンドを実行すると、数分でサーバが立ち上がる。SSHで接続し、動作を確認する。必要がなくなったら、`terminate` を実行する。サーバは消える。課金も止まる。月額ではなく時間課金。使った分だけ支払い、要らなくなったら捨てる。

私は画面を見ながら、しばらく呆然としていた。

これまで私が「インフラ」と呼んでいたものは、物理的な重さを持ち、電源ケーブルとLANケーブルに縛られ、ラックの中で唸りを上げる存在だった。それがAPIの数行で召喚され、数行で消滅する。私は言葉にならない違和感を覚え、やがてそれが「衝撃」であることに気づいた。

「サーバは消耗品になったのだ」

この認識が意味するところを、当時の私はまだ完全には理解していなかった。サーバに名前を付けなくなる時代。障害が起きたら修復するのではなく、捨てて新しいものを立てる時代。インフラが「ペット」から「家畜」に変わる時代。その入り口に、2006年8月のEC2があった。

あなたは今日、EC2インスタンスをどう扱っているだろうか。当たり前のように使い捨て、当たり前のように立ち上げ、当たり前のように消している。だが、その「当たり前」が当たり前になるまでには、長い道のりがあった。

---

## 2. AWSの前史——「余剰キャパシティ」という神話

### Amazonの内部インフラ危機

EC2がどこから来たのかを理解するには、2000年代初頭のAmazon.comの内部事情を知る必要がある。

2000年代初頭のAmazon.comは、急成長する電子商取引プラットフォームのインフラに苦しんでいた。当時のAmazonのアーキテクチャは、その時代に典型的なモノリスだった——単一の巨大なアプリケーション、共通の技術スタック、バックエンドには大規模なリレーショナルデータベース。チームはサービスの信頼性を維持するために、リソースの約70%を運用業務に費やしていたという。新機能の開発よりも、既存システムの維持に人員が吸い取られていく。

さらに深刻だったのは、共通のインフラリソースが存在しなかったことだ。各チームが独自にインフラの問題を解決し、同じ問題に対する解決策を繰り返し再発明していた。ストレージの管理、キューイングの実装、計算リソースの管理——これらの「インフラの基本機能」が、チームごとに異なる方法で実装されていた。

この状況はスケーラビリティの壁となった。新しいプロジェクトを始めるたびに、インフラの構築からやり直す。プロビジョニングに数週間かかる。チーム間でインフラのノウハウが共有されない。Amazonの成長速度に対して、インフラの準備が追いつかなくなっていた。

### 2003年——転換点

転換点は2003年に訪れた。

Andy Jassyは1997年にマーケティングマネージャーとしてAmazonに入社し、Jeff Bezosのテクニカルアドバイザー（いわゆる「shadow」）を務めた人物だ。2003年、Bezos邸で行われたエグゼクティブリトリートで、Amazonの経営陣はある発見をした。自社のコアコンピテンシーを棚卸しする演習の中で、Amazonがeコマース企業としての能力だけでなく、「インフラサービスの運用」に卓越した能力を持つことに気づいたのだ。

大規模なトラフィックをさばくための計算リソース管理、信頼性の高いストレージ、非同期処理のためのメッセージキュー——これらの能力は、電子商取引の裏側で培われてきたものだった。そしてJassyは、この能力を外部にサービスとして提供できるのではないかと考えた。

同じ2003年、AmazonのChris Pinkham（マネージャー）とBenjamin Black（ネットワークエンジニア）が、一つのペーパーを書いた。そこには、Amazonのインフラを完全に標準化し、完全に自動化し、ウェブサービスに全面的に依存する構想が描かれていた。さらに重要なことに、仮想サーバをサービスとして外部に販売する可能性にも言及されていた。

Pinkhamはその後、家族の事情で南アフリカのケープタウンに戻ることになった。だが、彼はEC2の開発を諦めなかった。優秀なリードデベロッパーを一人連れてケープタウンにオフィスを開設し、そこでEC2の開発チームを立ち上げた。ケープタウンとシアトルの間で、EC2は形を成していった。

### 「余剰キャパシティを売り始めた」は嘘

ここで、広く流布している一つの神話を正しておきたい。

「AWSはAmazonが持て余したサーバの余剰キャパシティを外部に売り始めたもの」——この説を、あなたも耳にしたことがあるかもしれない。直感的にはもっともらしい。巨大なeコマースサイトが抱える計算リソースは膨大で、ピーク時（ブラックフライデーやクリスマス）以外は余剰がある。その余剰を売ればビジネスになる——論理的に筋が通っているように見える。

だが、AWSのCTO Werner Vogelsはこの説を明確に否定している。「余剰キャパシティの話は神話だ」と。Andy Jassyも2008年のWiredインタビューで「内部システムの余剰キャパシティはとっくに使い切った」と述べており、2006年末にはAmazon.comの余剰キャパシティなど残っていなかったことが示されている。Vogelsによれば、仮にAmazon.comの余剰キャパシティを売り始めたとしても、AWSは2ヶ月で燃え尽きていたという。

AWSは余剰キャパシティの副産物ではない。Amazonが内部で培ったインフラ運用の能力を、意図的に、戦略的に、外部サービスとして再構築したものだ。この区別は重要だ。なぜなら、AWSのサービス設計には「Amazonの内部ツールをそのまま公開した」のではなく、「外部の開発者が使えるように再設計した」という意志が反映されているからだ。

### SQS、S3、そしてEC2

AWSの最初の公開インフラサービスは、EC2ではなかった。

2004年11月、SQS（Simple Queue Service）がベータとしてひっそりと公開された。メッセージキューイングサービスだ。分散システムにおけるコンポーネント間の非同期通信を実現するための基盤であり、Amazon内部で長年使われてきた技術の外部公開だった。

2006年3月14日、S3（Simple Storage Service）が公開された。オブジェクトストレージサービスだ。HTTPのPUT/GETでオブジェクトを格納・取得できる。「11ナイン」（99.999999999%）の耐久性を設計目標に掲げたS3は、ストレージの概念を根本から変えた。

そして2006年8月、EC2がベータとして公開された。

この順番は偶然ではない。SQS（メッセージング）→S3（ストレージ）→EC2（計算）という順は、AWSが「計算リソースの貸し出し」だけを目指していたのではないことを示している。AWSは最初から、独立した「ビルディングブロック」の集合体として設計されていた。計算、ストレージ、メッセージング——これらの基本要素をAPIで組み合わせることで、あらゆるアーキテクチャを構築できるプラットフォーム。その構想の中で、EC2は計算のビルディングブロックとして位置づけられた。

---

## 3. EC2の設計思想——何が革新的だったのか

### APIでサーバのライフサイクルを制御する

EC2の革新を理解するには、それ以前の「サーバを借りる」プロセスと比較する必要がある。

2006年以前、サーバを借りるということは、次のような手順を意味していた。

```
2006年以前の「サーバ調達」プロセス:

1. ホスティング業者のWebサイトでスペックを選ぶ
2. 申込書を送信する（場合によっては紙のFAXで）
3. 審査・契約手続きを待つ（数日〜数週間）
4. 業者がサーバをセットアップする（数時間〜数日）
5. SSHログイン情報がメールで届く
6. サーバにログインし、初期設定を手動で行う

所要時間: 数日〜数週間
課金単位: 月額固定
スケーリング: 追加サーバの申し込み → 同じプロセスの繰り返し
スペック変更: サポートに連絡 → 数時間〜数日のダウンタイム
解約: 月末までの契約期間の縛り
```

EC2はこのプロセスを根本から再定義した。

```
EC2の「サーバ調達」プロセス（2006年〜）:

1. API（またはCLI）でインスタンスタイプとAMIを指定する
2. APIを叩く
3. 数分でインスタンスが起動する
4. SSHで接続して使い始める

所要時間: 数分
課金単位: 時間単位（1時間あたり$0.10〜）
スケーリング: 同じAPIを叩すだけ（10台でも100台でも）
スペック変更: 別のインスタンスタイプで新しく起動
解約: terminateを実行 → 即座に課金停止
```

この差は「便利になった」という程度の改善ではない。パラダイムの転換だ。

サーバの調達が「人間の手続き」から「プログラムの実行」に変わった。つまり、サーバの起動・停止・削除をプログラムに組み込めるようになった。スクリプトがサーバを立て、スクリプトがサーバを消す。負荷が高まったらサーバを増やし、下がったら減らす。この一連のプロセスが自動化可能になったことこそが、EC2の本質的な革新だった。

### 初期EC2のスペックと制約

2006年8月にベータ公開された最初のEC2インスタンス（後にm1.smallと命名される）のスペックを見てみよう。

```
EC2初期インスタンス（後のm1.small）の仕様:

  CPU:     1.7 GHz Xeonプロセッサ相当（1 vCPU）
  メモリ:  1.75 GB
  ディスク: 160 GB（ローカル・インスタンスストア）
  NW:      250 Mbps
  OS:      Linux（Windowsは2008年10月から対応）
  仮想化:  Xen（準仮想化）
  価格:    $0.10/時間（約10セント/時間）

  年間コスト（24時間365日稼働の場合）:
    $0.10 × 24 × 365 = $876/年

  当時の専用サーバホスティング:
    同等スペックで $100〜200/月 = $1,200〜2,400/年

  EC2の利点:
    - 使わない時間は課金されない
    - 分単位で増減可能（当時は時間単位）
    - 初期費用なし、契約期間の縛りなし
```

一見すると、24時間365日稼働させた場合のコストは専用サーバと大差ないか、むしろEC2の方が安い程度に見える。だが、真の価値は「常時稼働させなくてもよい」という選択肢にあった。開発用サーバを朝立てて夜に消す。負荷試験のために100台を1時間だけ使い、終わったら全部消す。ピーク時にだけサーバを増やし、落ち着いたら減らす。これらは月額固定課金のモデルでは実現できなかった使い方だ。

### 永続ストレージの不在——意図的な「使い捨て」設計

ここで重要な事実がある。2006年のEC2には永続ストレージが存在しなかった。

初期EC2のインスタンスストア（160GB）は揮発性（ephemeral）だった。インスタンスを停止すると、ローカルディスク上のデータは全て消失する。再起動では保持されるが、停止や終了（terminate）ではデータは二度と戻ってこない。

EBS（Elastic Block Store）が登場したのは2008年8月20日——EC2のベータ開始から約2年後のことだ。2年間、EC2のユーザーは永続的なブロックストレージを持たなかった。データを永続化するにはS3にアップロードするしかなかった。

この「永続ストレージがない」という制約は、EC2の設計思想を鮮明に映し出している。EC2のインスタンスは「永続的なサーバ」ではなく「一時的な計算リソース」として設計されていた。状態を持たず、必要なときに起動し、不要になったら捨てる。状態はS3のような外部ストレージに保持し、計算とストレージを分離する。

後にこの思想は「Cattle, not Pets（ペットではなく家畜）」という標語で表現されることになる。ペットには名前を付け、病気になったら治療する。家畜は番号で管理し、問題があれば入れ替える。EC2は最初から、サーバを家畜として扱うための設計だった。

### AMI——マシンイメージのテンプレート化

AMI（Amazon Machine Image）は、EC2のもう一つのコア概念だ。

AMIとは、EC2インスタンスを起動するためのテンプレートである。OS、ミドルウェア、アプリケーション、設定——これらを含むマシンイメージをAMIとして保存し、同一構成のインスタンスを何台でも起動できる。

```
AMIの概念:

  ┌──────────────────────────────────┐
  │ AMI（Amazon Machine Image）     │
  │                                  │
  │ ┌────────────────────────┐      │
  │ │ ルートボリュームの      │      │
  │ │ テンプレート            │      │
  │ │ ── OS（Linux/Windows）  │      │
  │ │ ── ミドルウェア         │      │
  │ │ ── アプリケーション     │      │
  │ │ ── 設定ファイル         │      │
  │ └────────────────────────┘      │
  │                                  │
  │ ┌────────────────────────┐      │
  │ │ 起動権限               │      │
  │ │ ── どのアカウントが     │      │
  │ │    このAMIを使えるか   │      │
  │ └────────────────────────┘      │
  │                                  │
  │ ┌────────────────────────┐      │
  │ │ ブロックデバイス        │      │
  │ │ マッピング              │      │
  │ │ ── 起動時にアタッチする │      │
  │ │    ボリュームの定義     │      │
  │ └────────────────────────┘      │
  └──────────────────────────────────┘
           │
           │ 起動
           ▼
  ┌──────────┐ ┌──────────┐ ┌──────────┐
  │Instance-1│ │Instance-2│ │Instance-3│
  │ i-abc123 │ │ i-def456 │ │ i-ghi789 │
  └──────────┘ └──────────┘ └──────────┘
  同一AMIから複数のインスタンスを起動可能
```

AMIの概念は、第7回で述べたlibvirtの仮想マシン定義XMLや、VMwareのVM Templateの延長線上にある。だが決定的に異なるのは、AMIがAPI経由で操作可能な「クラウドリソース」であることだ。AMIを作成し、共有し、コピーし、別のリージョンに転送する——これら全てがAPIで実行できる。マシンイメージの管理がプログラマブルになったことで、デプロイの自動化が根本的に変わった。

### セキュリティグループ——仮想ファイアウォールの設計

EC2には当初からセキュリティグループという概念があった。

セキュリティグループは、EC2インスタンスに対する仮想ファイアウォールだ。インバウンド（受信）とアウトバウンド（送信）のトラフィックルールを定義し、許可する通信だけをインスタンスに到達させる。

従来のネットワークファイアウォールがネットワーク境界で一括してトラフィックを制御するのに対し、セキュリティグループは各インスタンスに直接アタッチされる分散型のモデルだ。インスタンスが頻繁に起動・停止され、IPアドレスが変わるクラウド環境において、ネットワーク境界に依存しないセキュリティモデルは合理的な設計だった。

初期のEC2（EC2-Classic）では、全てのインスタンスがAWSの共有フラットネットワーク上に配置されていた。顧客間のネットワーク分離はセキュリティグループに大きく依存していた。VPC（Virtual Private Cloud）による仮想ネットワークの分離が導入されたのは2009年のことであり、2013年12月以降はVPCがデフォルトとなった。

### Availability Zone——物理を意識した論理設計

EC2の設計でもう一つ重要な概念がAvailability Zone（AZ）だ。

AZとは、リージョン内の物理的に独立した障害ドメインである。各AZは独立した電力供給、冷却システム、ネットワーク接続を持ち、異なる変電所から電力を受ける。AZ間は最大約100km離れているが、一桁ミリ秒のレイテンシーで相互接続されており、同期レプリケーションが可能だ。

```
Availability Zoneの設計:

  ┌─────── リージョン（例: ap-northeast-1、東京）──────┐
  │                                                     │
  │  ┌──────────┐  ┌──────────┐  ┌──────────┐          │
  │  │ AZ-1a    │  │ AZ-1c    │  │ AZ-1d    │          │
  │  │          │  │          │  │          │          │
  │  │ 独立電力 │  │ 独立電力 │  │ 独立電力 │          │
  │  │ 独立冷却 │  │ 独立冷却 │  │ 独立冷却 │          │
  │  │ 独立NW   │  │ 独立NW   │  │ 独立NW   │          │
  │  └─────┬────┘  └─────┬────┘  └─────┬────┘          │
  │        │              │              │              │
  │        └──────────────┼──────────────┘              │
  │                       │                             │
  │            高速・低レイテンシー接続                  │
  │            （一桁ミリ秒）                           │
  │                                                     │
  │  設計原則:                                          │
  │  ── AZは独立した障害ドメイン                        │
  │  ── 一つのAZの障害が他のAZに波及しない             │
  │  ── ユーザーは複数AZにリソースを分散配置           │
  │     → 単一AZ障害に対する耐性を確保                 │
  └─────────────────────────────────────────────────────┘
```

AZの設計は、物理インフラの障害パターンを深く理解した上で生まれている。データセンターは、電力障害、冷却システムの故障、ネットワーク切断、自然災害——様々な原因で停止しうる。単一のデータセンターに全てを置けば、そのデータセンターの障害が即座にサービス全体の障害となる。

AZはこの問題に対して、「物理的に独立した複数の障害ドメインを、論理的に一つのリージョンとして扱えるようにする」という解を提示した。ユーザーはアプリケーションを複数のAZに分散配置することで、単一AZの障害に対する耐性を確保できる。この設計は、クラウド以前のデータセンターにおけるDR（Disaster Recovery）の概念を、日常的なアーキテクチャの一部として取り込んだものだ。

### EC2の設計判断をまとめる

ここで、EC2の設計判断を整理しよう。

```
EC2の5つの設計判断:

  1. API駆動（Programmable）
     サーバのライフサイクルをプログラムから制御可能にした
     → インフラの自動化が可能に

  2. 従量課金（Pay-as-you-go）
     時間単位の課金。使った分だけ支払う
     → インフラコストが固定費から変動費に

  3. 使い捨て性（Disposability）
     インスタンスは一時的な存在。状態を持たない設計
     → 障害対応が「修復」から「再作成」に

  4. マシンイメージ（AMI）
     テンプレートから同一構成のインスタンスを量産
     → デプロイの再現性と自動化

  5. 障害ドメインの分離（Availability Zone）
     物理的に独立した障害ドメインを論理的に提供
     → 高可用性が設計レベルで実現可能に
```

これら5つの設計判断は、個別に見ればそれぞれ興味深いが、組み合わさったときに真の威力を発揮する。API駆動だから自動化できる。従量課金だから使い捨てが経済的に合理的になる。使い捨て可能だからAMIでテンプレート化する意味がある。テンプレートから即座に起動できるから、複数AZに分散配置する障壁が下がる。

個々の技術的イノベーションではなく、これらの設計判断の「組み合わせ」こそが、EC2の本質的な革新だった。

---

## 4. ハンズオン——AWS CLIでEC2のライフサイクルを体験する

ここからは、AWS CLIを使ってEC2インスタンスのライフサイクルを体験する。UserDataスクリプトによる初期設定自動化を実装し、「使い捨てサーバ」の概念を手で確かめる。

AWSアカウントの代わりにLocalStack（AWS互換のローカルエミュレータ）を使い、実際のAWS課金なしでEC2の操作感を体験する。

### 環境

- Docker（Ubuntu 24.04ベースコンテナ）
- LocalStack（AWS互換ローカルエミュレータ）
- AWS CLI v2

### 演習1：EC2操作環境のセットアップ

```bash
# Docker環境に入る
docker run -it --rm \
  --name ec2-handson ubuntu:24.04 bash

# 必要なツールをインストール
apt-get update && apt-get install -y \
  curl unzip python3 python3-pip jq
```

```bash
echo "=== 演習1: EC2操作環境のセットアップ ==="
echo ""

# AWS CLI v2のインストール
echo "--- AWS CLI v2のインストール ---"
curl -s "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" \
  -o "awscliv2.zip"
unzip -q awscliv2.zip
./aws/install
rm -rf awscliv2.zip aws
echo ""

# バージョン確認
aws --version
echo ""

# LocalStackなしでもCLIの構造を理解できるように
# ダミーのクレデンシャルを設定
echo "--- AWS CLIの設定（ローカル学習用） ---"
mkdir -p ~/.aws
cat > ~/.aws/credentials << 'EOF'
[default]
aws_access_key_id = AKIAIOSFODNN7EXAMPLE
aws_secret_access_key = wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
EOF

cat > ~/.aws/config << 'EOF'
[default]
region = ap-northeast-1
output = json
EOF

echo "AWS CLI設定完了"
echo ""
echo "注意: これはローカル学習用のダミー認証情報です"
echo "      実際のAWSアカウントには接続しません"
echo ""

echo "=== 演習1完了 ==="
```

### 演習2：EC2のライフサイクルをCLIコマンドで理解する

AWS CLIのコマンド体系そのものが、EC2の設計思想を表現している。

```bash
echo "=== 演習2: EC2ライフサイクルのコマンド体系 ==="
echo ""

echo "EC2インスタンスのライフサイクル:"
echo ""
echo "  [AMI] → run-instances → [pending] → [running]"
echo "                            stop-instances → [stopped]"
echo "                            start-instances → [running]"
echo "                            terminate-instances → [terminated]"
echo ""

echo "--- AWS CLIとvirshの対比 ---"
echo ""
echo "  virsh define       →  （AMIの登録に相当）"
echo "  virsh start        →  aws ec2 run-instances"
echo "  virsh list         →  aws ec2 describe-instances"
echo "  virsh shutdown     →  aws ec2 stop-instances"
echo "  virsh undefine     →  aws ec2 terminate-instances"
echo "  virsh snapshot     →  aws ec2 create-image"
echo ""
echo "クラウドAPIは、libvirt/virshの設計を"
echo "HTTP API化し、認証・課金・スケーリングを"
echo "組み込んだものと理解できる。"
echo ""

echo "=== 演習2完了 ==="
```

### 演習3：UserDataによる初期設定自動化——使い捨てサーバの実践

EC2の「使い捨て」設計を実践的に理解するために、UserDataスクリプトの概念を学ぶ。

```bash
echo "=== 演習3: UserDataの概念と使い捨てサーバの設計 ==="
echo ""

echo "UserDataとは:"
echo "  EC2インスタンスの初回起動時に自動実行されるスクリプト。"
echo "  インスタンスが起動するたびに同じ初期設定が適用されるため、"
echo "  手動設定なしで即座にサービスを開始できる。"
echo ""
echo "  これが「使い捨て」設計の核心だ。"
echo "  サーバに手動で設定を施す必要がなければ、"
echo "  いつでも新しいサーバを立てて古いサーバを捨てられる。"
echo ""

# UserDataスクリプトの例を作成
echo "--- UserDataスクリプトの例 ---"
echo ""

WORK_DIR="/tmp/ec2-handson"
mkdir -p "${WORK_DIR}"

cat > "${WORK_DIR}/userdata-webserver.sh" << 'USERDATA'
#!/bin/bash
# EC2 UserDataスクリプト: Webサーバの自動セットアップ
# このスクリプトはインスタンスの初回起動時に自動実行される

set -euo pipefail

# ログ出力
exec > >(tee /var/log/userdata.log) 2>&1
echo "=== UserData実行開始: $(date) ==="

# パッケージの更新とインストール
apt-get update -y
apt-get install -y nginx

# Webサーバの設定
INSTANCE_ID=$(curl -s http://169.254.169.254/latest/meta-data/instance-id \
  2>/dev/null || echo "local-demo")
AZ=$(curl -s http://169.254.169.254/latest/meta-data/placement/availability-zone \
  2>/dev/null || echo "demo-az")

cat > /var/www/html/index.html << HTML
<!DOCTYPE html>
<html>
<head><title>EC2 Instance Info</title></head>
<body>
<h1>EC2 Instance Information</h1>
<p>Instance ID: ${INSTANCE_ID}</p>
<p>Availability Zone: ${AZ}</p>
<p>Launched at: $(date -u +"%Y-%m-%dT%H:%M:%SZ")</p>
<p>This server is disposable. It can be terminated and
   re-created from the same AMI + UserData at any time.</p>
</body>
</html>
HTML

# Nginxの起動
systemctl enable nginx
systemctl start nginx

echo "=== UserData実行完了: $(date) ==="
USERDATA

echo "作成したUserDataスクリプト:"
echo ""
cat "${WORK_DIR}/userdata-webserver.sh"
echo ""
echo ""

echo "--- AWS CLIでの使用方法（概念） ---"
echo ""
echo '  # UserDataを指定してインスタンスを起動'
echo '  aws ec2 run-instances \'
echo '    --image-id ami-xxxxx \'
echo '    --instance-type t3.micro \'
echo '    --user-data file://userdata-webserver.sh \'
echo '    --security-group-ids sg-xxxxx \'
echo '    --tag-specifications "ResourceType=instance,Tags=[{Key=Name,Value=web-server}]"'
echo ""
echo "このコマンド一つで:"
echo "  1. AMIからインスタンスが起動する"
echo "  2. UserDataスクリプトが自動実行される"
echo "  3. Nginxがインストール・設定・起動される"
echo "  4. Webサーバが公開される"
echo ""
echo "手動作業: ゼロ"
echo "所要時間: 数分"
echo ""
echo "同じコマンドを10回叩けば、10台の同一構成のWebサーバが立つ。"
echo "そしてどの1台が壊れても、同じコマンドで新しい1台が立つ。"
echo "これが「使い捨て」設計の力だ。"
echo ""

echo "=== 演習3完了 ==="
```

### 演習4：EC2の設計思想を従来モデルと比較する

```bash
echo "=== 演習4: EC2の設計思想——パラダイム比較 ==="
echo ""

echo "--- 「ペット」モデル vs 「家畜」モデル ---"
echo ""
echo "  ペット（EC2以前）        家畜（EC2以降）"
echo "  ──────────────────────────────────────────"
echo "  名前を付ける             IDで管理"
echo "  手動セットアップ         AMI + UserDataで自動"
echo "  障害は修復する           障害は捨てて作り直す"
echo "  寿命は数ヶ月〜数年      寿命は数分〜数日"
echo "  月額固定課金             時間（秒）単位課金"
echo ""
echo "EC2は「サーバ」の概念を消したのではない。"
echo "「サーバとの付き合い方」を変えたのだ。"
echo ""

echo "=== 演習4完了 ==="
```

### この演習で何がわかるか

**第一に、EC2のAPI設計がインフラのプログラマビリティを実現したこと。** `run-instances`、`describe-instances`、`terminate-instances`——これらのコマンドは、第7回で学んだvirshの`start`、`list`、`undefine`と構造的に同じだ。libvirt/virshが確立した仮想マシンのライフサイクル管理パターンを、EC2はHTTP APIとして世界中からアクセス可能にした。

**第二に、UserDataの概念が「使い捨てサーバ」を実現したこと。** サーバの初期設定をスクリプトとして宣言し、起動時に自動適用する。この仕組みがあるからこそ、サーバを壊して作り直すコストがほぼゼロになる。手動設定が必要なサーバは使い捨てにできない。自動設定されるサーバだからこそ使い捨てにできる。

**第三に、EC2が「ペット」から「家畜」へのパラダイムシフトを可能にしたこと。** サーバに名前を付け、個別に管理し、障害時に修復する——この「ペット」モデルは、EC2以前の必然だった。サーバの調達に時間とコストがかかる以上、既存のサーバを大事に使い続けるしかなかった。EC2は調達のコストを劇的に下げることで、「壊れたら捨てて作り直す」という「家畜」モデルを経済的に合理的にした。

ハンズオンの詳細な手順と自動セットアップスクリプトは、本リポジトリの `handson/cloud-history/08-aws-ec2-2006/` に用意してある。

---

## 5. まとめと次回予告

### この回のまとめ

第8回では、2006年のAWS EC2の登場がなぜ「サーバを借りる」という概念を根本から変えたのかを追った。

**EC2の革新は「仮想サーバを提供した」ことではない。** 仮想サーバの提供自体は、VPS（第5回）やホスティングサービスで既に実現されていた。EC2が変えたのは、サーバのライフサイクルをAPIで制御し、時間単位で課金し、使い捨てを前提とする——この設計思想の組み合わせだ。

**AWSは余剰キャパシティの副産物ではなかった。** 2000年代初頭のAmazonが直面していた内部インフラ課題——モノリスアーキテクチャの限界、チーム間で共有されないインフラ基盤、運用業務に吸い取られるリソース——これらの課題を解決する過程で培われた能力が、戦略的にサービス化されたものだ。2003年のChris PinkhamとBenjamin Blackのペーパー、Andy Jassyが率いた57人のチーム、南アフリカのケープタウンで行われたEC2の開発——この道のりは「余剰を売る」どころか、新しいビジネスを一から構築するものだった。

**EC2の5つの設計判断が、クラウドコンピューティングのパラダイムを定義した。** API駆動（Programmable）、従量課金（Pay-as-you-go）、使い捨て性（Disposability）、マシンイメージ（AMI）、障害ドメインの分離（Availability Zone）。これらは個別に見ればそれぞれの先行技術が存在するが、組み合わさったときに「インフラのプログラマビリティ」という新しい概念を生み出した。

**初期EC2の制約が「使い捨て」設計を強化した。** 永続ストレージ（EBS）が存在しなかった最初の2年間、EC2のユーザーは否応なく「インスタンスはいつ消えてもおかしくない」という前提でアプリケーションを設計せざるを得なかった。この制約は、結果として「ステートレスな計算ノード＋外部ストレージ」という分離アーキテクチャを促進し、後のクラウドネイティブ設計の原型を作った。

冒頭の問いに答えよう。「EC2は何が革新的だったのか？」——EC2は、サーバを「大事に管理する資産」から「必要なときに召喚し、不要になったら破棄する一時的なリソース」に変えた。この転換を可能にしたのは、API駆動の設計、従量課金のビジネスモデル、使い捨てを前提としたアーキテクチャの組み合わせだった。根底にある思想——計算資源を共有し、必要な分だけ切り出して提供する——は、メインフレーム以来変わっていない。だがEC2は、その「借りる」という行為をプログラマブルにした最初のサービスだった。

### 次回予告

第9回では、「S3、SQS——クラウドの基本構成要素」を探る。

EC2が計算のビルディングブロックだとすれば、S3はストレージの、SQSはメッセージングのビルディングブロックだ。AWSは最初から、これらの独立したサービスをAPIで組み合わせるアーキテクチャを志向していた。

EC2には永続ストレージがなかった。ではデータはどこに置くのか。S3だ。EC2のインスタンスは一時的な存在だ。ではインスタンス間の通信はどう行うのか。SQSだ。クラウドを「サーバの貸し出し」以上のものにしたこれらの概念を、次回辿る。

あなたが今、S3にオブジェクトをPUTするとき、そのデータがどのように保存され、なぜ「99.999999999%の耐久性」を達成できるのか——考えたことがあるだろうか。

---

## 参考文献

- AWS, "Announcing Amazon Elastic Compute Cloud (Amazon EC2) - beta", 2006. <https://aws.amazon.com/about-aws/whats-new/2006/08/24/announcing-amazon-elastic-compute-cloud-amazon-ec2---beta/>
- Black, B., "EC2 Origins", 2009. <https://blog.b3k.us/2009/01/25/ec2-origins.html>
- TechCrunch, "How AWS came to be", 2016. <https://techcrunch.com/2016/07/02/andy-jassys-brief-history-of-the-genesis-of-aws/>
- TechCrunch, "How Amazon EC2 grew from a notion into a foundational element of cloud computing", 2021. <https://techcrunch.com/2021/08/28/how-amazon-ec2-grew-from-a-notion-into-a-foundational-element-of-cloud-computing/>
- AWS, "EC2 Instance History", AWS News Blog. <https://aws.amazon.com/blogs/aws/ec2-instance-history/>
- Vogels, W., "Amazon EBS - Elastic Block Store has launched", All Things Distributed, 2008. <https://www.allthingsdistributed.com/2008/08/amazon_ebs_elastic_block_store.html>
- Vogels, W., "Continuous reinvention: A brief history of block storage at AWS", All Things Distributed, 2024. <https://www.allthingsdistributed.com/2024/08/continuous-reinvention-a-brief-history-of-block-storage-at-aws.html>
- AWS, "Amazon SQS – 15 Years and Still Queueing!", AWS News Blog. <https://aws.amazon.com/blogs/aws/amazon-sqs-15-years-and-still-queueing/>
- AWS, "Availability Zones - AWS Fault Isolation Boundaries". <https://docs.aws.amazon.com/whitepapers/latest/aws-fault-isolation-boundaries/availability-zones.html>
- AWS, "EC2-Classic is Retiring – Here's How to Prepare", AWS News Blog. <https://aws.amazon.com/blogs/aws/ec2-classic-is-retiring-heres-how-to-prepare/>
- Network World, "The myth about how Amazon's Web service started just won't die", 2015. <https://www.networkworld.com/article/936248/the-myth-about-how-amazon-s-web-service-started-just-won-t-die.html>
- Wikipedia, "Amazon Elastic Compute Cloud". <https://en.wikipedia.org/wiki/Amazon_Elastic_Compute_Cloud>
- Wikipedia, "Andy Jassy". <https://en.wikipedia.org/wiki/Andy_Jassy>
- Wikipedia, "Timeline of Amazon Web Services". <https://en.wikipedia.org/wiki/Timeline_of_Amazon_Web_Services>
